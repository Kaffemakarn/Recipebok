<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en"
      xmlns="http://www.w3.org/1999/xhtml"
       xmlns:b="http://bootsfaces.net/ui"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
    
    <h:head>
        <h:outputStylesheet library="css" name="style.css"/>
        <script src="https://www.gstatic.com/firebasejs/4.10.1/firebase.js"></script>
        <!--<h:outputScript library= "js" name="index2.js"/>-->
        <!--<h:outputScript library= "js" name="firebase.js"/>-->
        


        <title>Login test</title>
    </h:head>
    <h:body>
        <div id="login_div" class="main-div">
            <h3> Login </h3>
            <input type="email" placeholder="Email..." id="email_field" />
            <input type="password" placeholder="Password..." id="password_field" />

            <button onclick="login()" >Login to Account</button>
            <p onclick="goToRegister()" style='margin-bottom:0;'>Don't have an account?</p><p onclick="goToRegister()" style='margin-top:0;'> Register here</p>
        </div>

        <div id="user_div">
            <ui:include src="../index.xhtml"/>
            <button id="user_div_button" onclick="logout()">Logout</button>
        </div>
        
        <div id="register_div" class="registered-div " style=" display: none">

                <h3>Create Account</h3>
                <input id="name_field_register" type="name"  placeholder="Name..." value="#{userbean.tmp.username}"/>
                <input id="email_field_register" type="email"  placeholder="Email..." value="#{userbean.tmp.email}"/>
                <input type="password" placeholder="Password..." id="password_field_register" />
                <button value="Register" onclick="register()" />

            <!--<button onclick="register()" >Register</button>-->
            <p onclick="goToLogin()">Back to login</p>
        </div>

        
    
  
    <!--Configure firebase-->
        <script>
        // Initialize Firebase
            var config = {
                apiKey: "AIzaSyBqpKfLJRB4qlk5jWNYN3YgIaa8obYWjMY",
                authDomain: "recipebok.firebaseapp.com",
                databaseURL: "https://recipebok.firebaseio.com",
                projectId: "recipebok",
                storageBucket: "recipebok.appspot.com",
                messagingSenderId: "287255300496",
                clientId : "287255300496-iktt97r9vie0imuvq3a31n3gh7bmmhha.apps.googleusercontent.com",

                scopes: [
                       "email",
                       "profile"
              ]
            };
            firebase.initializeApp(config);

        </script>
    
    <!--Firebase operations-->    
        <script>
            
            var credential;
            firebase.auth().onAuthStateChanged(function(user) {
                
                if (user) {
                    // User is signed in.

                    document.getElementById("user_div").style.display = "block";
                    document.getElementById("user_div_button").style.display = "block";
                    document.getElementById("login_div").style.display = "none";
                    document.getElementById("register_div").style.display = "none";
                    
                    //window.location.replace("../Recipebok/index.xhtml");

                    var user = firebase.auth().currentUser;
                    
                    //if(user != null){
                        //var email_id = user.email;
                        //document.getElementById("user_para").innerHTML = "Welcome User : " + email_id;
                        
                    //}

                } else {
                    // No user is signed in.

                    //document.getElementById("user_div").src = "../empty.html";
                    document.getElementById("user_div").style.display = "none";
                    document.getElementById("login_div").style.display = "block";
                    document.getElementById("register_div").style.display = "none";
                    document.getElementById("user_div_button").style.display = "none";

                }
            });
            
            function goToRegister(){
                
                document.getElementById("user_div").style.display = "none";
                document.getElementById("login_div").style.display = "none";
                document.getElementById("register_div").style.display = "block";
                document.getElementById("user_div_button").style.display = "none";
            }
            
             function goToLogin(){
                 
                 
                
                document.getElementById("user_div").style.display = "none";
                document.getElementById("login_div").style.display = "block";
                document.getElementById("register_div").style.display = "none";
                document.getElementById("user_div_button").style.display = "none";
            }
            
            function login(){

                var userEmail = document.getElementById("email_field").value;
                var userPass = document.getElementById("password_field").value;

                firebase.auth().signInWithEmailAndPassword(userEmail, userPass).catch(function(error) {
                    // Handle Errors here.
                    var errorCode = error.code;
                    var errorMessage = error.message;

                    window.alert("Error : " + errorMessage);

                    // ...
                });

            }

            function register() {
              var email = document.getElementById("email_field_register").value;
              var password = document.getElementById("password_field_register").value;
              if (!email || !password) {
                return console.log('email and password required');
              }
              // Register user
              firebase.auth().createUserWithEmailAndPassword(email, password)
                .catch(function(error) {
                  console.log('register error', error);
                  if (error.code === 'auth/email-already-in-use') {
                  var credential = firebase.auth.EmailAuthProvider.credential(email, password);
                  }
                });
                
                #{userbean.add()};

            };
        
            function logout(){
                firebase.auth().signOut();
            }
            
            
            
        </script>
      
    </h:body>

</html>
